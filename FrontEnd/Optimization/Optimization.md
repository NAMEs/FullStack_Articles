# Web前端性能优化

## 减少HTTP请求

* 基本原理  

在浏览器(客户端)和服务器发生通信时，就已经消耗了大量的时间，尤其是在网络情况比较糟糕的时候，这个问题尤其的突出。

一个正常HTTP请求的流程简述：如在浏览器中输入"www.xxxxxx.com"并按下回车，浏览器再与这个URL指向的服务器建立连接，然后浏览器才能向服务器发送请求信息，服务器在接受到请求的信息后再返回相应的信息，浏览器接收到来自服务器的应答信息后，对这些数据解释执行。

而当我们请求的网页文件中有很多图片、CSS、JS甚至音乐等信息时，将会频繁的与服务器建立连接，与释放连接，这必定会造成资源的浪费，且每个HTTP请求都会对服务器和浏览器产生性能负担。

网速相同的条件下，下载一个100KB的图片比下载两个50KB的图片要快。所以，请减少HTTP请求。

* 解决办法：

合并图片（css sprites），合并CSS和JS文件；图片较多的页面也可以使用 lazyLoad 等技术进行优化。

## 正确理解 Repaint 和 Reflow

* 基本原理：

`Repaint`(重绘)就是在一个元素的外观被改变，但没有改变布局(宽高)的情况下发生，如改变visibility、outline、背景色等等。

`Reflow`(重排)就是DOM的变化影响到了元素的几何属性（宽和高），浏览器会重新计算元素的几何属性，会使渲染树中受到影响的部分失效，浏览器会验证DOM树上的所有其它结点的`visibility`属性，这也是`Reflow`低效的原因。如：改变窗囗大小、改变文字大小、内容的改变、浏览器窗口变化，style属性的改变等等。如果Reflow的过于频繁，CPU使用率就会噌噌的往上涨，所以前端也就有必要知道`Repaint`和`Reflow`的知识。

* 减少性能影响的办法：

* * 上面提到通过设置style属性改变节点样式的话，每设置一次都会导致一次reflow，所以最好通过设置`class`的方式；
* * 有动画效果的元素，它的`position`属性应当设为`fixed`或`absolute`，这样不会影响其它元素的布局；
* * 如果功能需求上不能设置`position`为`fixed`或`absolute`，那么就权衡速度的平滑性。

总之，因为`Reflow`有时确实不可避免，所以只能尽可能限制`Reflow`的影响范围。

##　请减少对DOM的操作

* 基本原理：

对DOM操作的代价是高昂的，这在网页应用中的通常是一个性能瓶颈。

天生就慢。在《高性能JavaScript》中这么比喻：“把DOM看成一个岛屿，把JavaScript(ECMAScript)看成另一个岛屿，两者之间以一座收费桥连接”。所以每次访问DOM都会教一个过桥费，而访问的次数越多，交的费用也就越多。所以一般建议尽量减少过桥次数。

* 解决办法：

* * 修改和访问DOM元素会造成页面的`Repaint`和`Reflow`，循环对`DOM`操作更是罪恶的行为。所以请合理的使用`JavaScript`变量储存内容，考虑大量DOM元素中循环的性能开销，在循环结束时一次性写入

* * 减少对DOM元素的查询和修改，查询时可将其赋值给局部变量。

 *注：在IE中:hover会降低响应速度*

## 使用JSON格式来进行数据交换

基本原理：

`JSON`是一种轻量级的数据交换格式，采用完全独立于语言的文本格式，是理想的数据交换格式。同时，`JSON`是`JavaScript`原生格式，这意味着在`JavaScript`中处理 `JSON`数据不需要任何特殊的API或工具包。

与`XML`序列化相比，`JSON`序列化后产生的数据一般要比`XML`序列化后数据体积小，所以在`Facebook`等知名网站中都采用了`JSON`作为数据交换方式。

##　注意控制Cookie大小和污染

* 基本原理和使用方法：

 因为Cookie是本地的磁盘文件，每次浏览器都会去读取相应的Cookie，所以建议去除不必要的Coockie，使Coockie体积尽量小以减少对用户响应的影响；

 使用Cookie跨域操作时注意在适应级别的域名上设置coockie以便使子域名不受其影响；

 Cookie是有生命周期的，所以请注意设置合理的过期时间，合理地Expire时间和不要过早去清除coockie，都会改善用户的响应时间。